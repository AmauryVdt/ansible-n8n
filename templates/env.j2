# Fichier généré par Ansible. Ne pas modifier manuellement.

# ===== Configuration de la base de données (PostgreSQL) =====
DB_TYPE=postgresdb
DB_POSTGRESDB_DATABASE={{ DB_POSTGRESDB_DATABASE }}
DB_POSTGRESDB_HOST={{ DB_POSTGRESDB_HOST }}
DB_POSTGRESDB_PORT={{ DB_POSTGRESDB_PORT }}
DB_POSTGRESDB_USER={{ DB_POSTGRESDB_USER }}
DB_POSTGRESDB_PASSWORD={{ DB_POSTGRESDB_PASSWORD }}
DB_SSL={{ N8N_DB_SSL_ENABLED | default('true') }}
DB_POSTGRESDB_SSL_REJECT_UNAUTHORIZED=false

# ===== Variables générales =====
N8N_HOST={{ N8N_DOMAIN }}
N8N_PORT=5678
N8N_PROTOCOL=https
NODE_ENV=production
WEBHOOK_URL=https://{{ N8N_DOMAIN }}/
GENERIC_TIMEZONE={{ TIMEZONE }}
N8N_ENFORCE_SETTINGS_FILE_PERMISSIONS=true

# ===== n8n Queue over Redis Cluster =====
EXECUTIONS_MODE=queue
QUEUE_BULL_PREFIX=n8n
QUEUE_BULL_REDIS_PASSWORD={{ redis_password }}

# Liste des nœuds du cluster au format host:port (créés plus bas dans compose)
# n8n utilisera le client Redis Cluster et ignorera HOST/PORT simples
{% if redis_cluster_enabled %}
QUEUE_BULL_REDIS_CLUSTER_NODES={% for i in range(redis_cluster_nodes) -%}
redis-node-{{ i }}:6379{% if not loop.last %},{% endif %}{% endfor %}
{% else %}
QUEUE_BULL_REDIS_HOST=redis
QUEUE_BULL_REDIS_PORT=6379
{% endif %}

# (optionnel)
#QUEUE_BULL_REDIS_TLS=false
#QUEUE_BULL_REDIS_TIMEOUT_THRESHOLD=10000